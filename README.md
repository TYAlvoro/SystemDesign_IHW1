# Прототип банковской системы.

## 1. Общая идея решения

Основная цель — разработать консольное приложение «Учет финансов» с возможностью ведения счетов, категорий и операций (доходы/расходы), а также предоставить аналитические функции (расчет чистого дохода, группировка по категориям), импорт/экспорт данных и измерение времени выполнения операций.

Реализация состоит из двух проектов:

1. **Yahyaev_SD_IHW_1** — основной проект (консольное приложение).
2. **FacadeTests** — тестовый проект (xUnit).

Проект соответствует принципам **SOLID** и **GRASP**, а также демонстрирует использование ряда паттернов GoF (Фабрика, Фасад, Команда + Декоратор, Шаблонный метод, Посетитель, Наблюдатель и Прокси/репозиторий).

## 2. Используемые паттерны

### 2.1 Фабрика (Factory)
- **DomainFactory**  
  Позволяет централизованно создавать объекты `BankAccount`, `Category`, `Operation`, инкапсулируя логику валидации (например, запрет отрицательной суммы).

### 2.2 Фасад (Facade)
- **FinanceFacade**  
  Объединяет операции над доменными объектами и взаимодействует с репозиторием. Предоставляет единый интерфейс для создания, редактирования, удаления счетов, категорий и операций, а также аналитические методы (расчет чистого дохода, группировка по категориям и пересчет баланса).

### 2.3 Команда (Command) + Декоратор (Decorator)
- **ICommand**  
  Интерфейс для инкапсуляции пользовательского сценария (например, создание счета, операции).  
- **TimingCommandDecorator**  
  Декоратор, оборачивающий команды и измеряющий время их выполнения. Это позволяет добавлять дополнительное поведение (логирование, статистика) без изменения кода самих команд.

### 2.4 Шаблонный метод (Template Method)
- **DataImporter (абстрактный класс)**  
  Определяет общий алгоритм импорта: чтение файла, парсинг содержимого, обработка данных.  
- **Конкретные импортёры (CSVDataImporter, JSONDataImporter, YAMLDataImporter)**  
  Реализуют метод парсинга для каждого формата.

### 2.5 Посетитель (Visitor)
- **IVisitor / IVisitable**  
  Позволяют отделить логику обхода доменных объектов от самих объектов.  
- **UnifiedExportVisitor**  
  Собирает все объекты (счета, категории, операции) и передает их в экспортеры, которые затем сериализуют данные в нужный формат (JSON, CSV, YAML).

### 2.6 Наблюдатель (Observer)
- **BankAccount**  
  Содержит событие `OnBalanceChanged`, вызываемое при изменении баланса.  
- **IBankAccountObserver** и **BalanceLogger**  
  Подписываются на событие, логгируют изменения баланса. Это иллюстрирует принцип отделения реакции на событие от самого объекта.

### 2.7 Прокси (Proxy) / Репозиторий
- **IFinanceRepository**  
  Определяет операции чтения/записи для счетов, категорий и операций.  
- **FinanceRepository**  
  Хранит данные в памяти (in-memory). При создании/обновлении операции сразу корректирует баланс счета. При необходимости можно заменить на реализацию, работающую с базой данных, не меняя бизнес-логику.

## 3. Архитектура и структура проекта
```
Yahyaev_SD_IHW_1.sln
├─ Yahyaev_SD_IHW_1           // Основной проект (консольное приложение)
│  ├─ Program.cs              // Точка входа
│  ├─ Domain/                 // Доменные классы (BankAccount, Category, Operation)
│  ├─ Facade/                 // FinanceFacade
│  ├─ Factories/              // DomainFactory
│  ├─ Infrastructure/         // IFinanceRepository, InMemoryFinanceRepository
│  ├─ Observer/               // IBankAccountObserver, BalanceLogger
│  ├─ DataImport/             // DataImporter (шаблонный метод), CSVDataImporter, JSONDataImporter, YAMLDataImporter
│  ├─ DataExport/             // DataExporter (шаблонный метод), CSVDataExporter, JSONDataExporter, YAMLDataExporter
│  ├─ Timing/                 // ICommand, TimingCommandDecorator
│  └─ Visitor/                // IVisitor, IVisitable, UnifiedExportVisitor
└─ FacadeTests                // Тестовый проект (xUnit)
└─ FinanceFacadeTests.cs   // Набор юнит-тестов
```

## 4. Основной функционал

1. **Работа с доменной моделью**  
   - Создание, редактирование, удаление счетов, категорий, операций.  
   - При создании операции баланс счета автоматически корректируется.

2. **Аналитика**  
   - Расчет чистого дохода за период (сумма доходов – сумма расходов).  
   - Группировка операций по категориям.

3. **Импорт и экспорт**  
   - **Импорт** (CSV, JSON, YAML) с помощью `DataImporter` и конкретных реализаций.  
   - **Экспорт** (CSV, JSON, YAML) с помощью `DataExporter` и `UnifiedExportVisitor`.

4. **Управление данными**  
   - Пересчет баланса (если требуется, например, при редактировании или после импорта).  
   - InMemory-хранилище (репозиторий).

5. **Статистика**  
   - Измерение времени выполнения команд (например, создание счета) с помощью `TimingCommandDecorator`.

## 5. Юнит-тесты (xUnit)

Отдельный проект **FacadeTests** содержит тесты, покрывающие:

- Создание счетов, операций, категорий (проверка корректности данных).  
- Обновление баланса при создании/обновлении/удалении операций.  
- Реакцию наблюдателя (Observer) на изменение баланса.  
- При необходимости можно добавить тесты импорта/экспорта.

# Инструкция по запуску проекта и тестов

Ниже описаны основные шаги по сборке и запуску приложения и тестов в консоли, используя .NET CLI.

## 1. Клонирование репозитория

1. Откройте терминал (консоль).
2. Выполните команду:

```bash
git clone https://github.com/TYAlvoro/SystemDesign_IHW1
cd SystemDesign_IHW1
```

### Структура репозитория

После клонирования репозитория у вас локально будет следующая структура:

- **Yahyaev_SD_IHW_1** — основной проект (консольное приложение).
- **FacadeTests** — тестовый проект с xUnit-тестами.

## 2. Сборка проекта
```bash
dotnet build Yahyaev_SD_IHW_1/Yahyaev_SD_IHW_1.csproj
dotnet build FacadeTests/FacadeTests.csproj
```

## 3. Запуск приложения
```bash
dotnet run --project Yahyaev_SD_IHW_1/Yahyaev_SD_IHW_1.csproj
```

## 4. Запуск тестов
```bash
dotnet test FacadeTests/FacadeTests.csproj
```

# Уточнения
Для проверки импорта достаточно передать относительный путь к приложенным файлам.
А еще я случайно сделал форс-пуш и потерял историю коммитов на 12+ единиц...
